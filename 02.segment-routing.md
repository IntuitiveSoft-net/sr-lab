# Segment Routing Lab

```bash
show isis interface brief
```
```

```


```bash
show isis neighbor
```
```

```

```bash
show isis topology
```


```bash
show ip route 
```
```

```

Activate segment-routing on xrd-1 
```bash
configure terminal
router isis core
 address-family ipv4 unicast
  segment-routing mpls
 interface Loopback0
  address-family ipv4 unicast
   prefix-sid absolute 16001
commit
```

Adapt the configuration template and configure accordingly lab devices xrd-1 to xrd-6 : <a href="javascript:scrollLab('SR-MPLS-configurations')">Configurations snippets</a>

```bash
show mpls forwarding
```


```bash
show mpls label table detail 
```
```

```


```
RP/0/RP0/CPU0:xrd-1#show ospf neighbor detail 
Thu Oct 27 15:47:29.932 UTC

* Indicates MADJ interface
# Indicates Neighbor awaiting BFD session up

Neighbors for OSPF 1

 Neighbor 3.3.3.3, interface address 100.1.3.3
    In the area 0 via interface GigabitEthernet0/0/0/0 
    Neighbor priority is 1, State is FULL, 6 state changes
    DR is 100.1.3.3 BDR is 100.1.3.1
    Options is 0x52  
    LLS Options is 0x1 (LR)
    Dead timer due in 00:00:34
    Neighbor is up for 00:33:14
    Number of DBD retrans during last exchange 0
    Index 1/1, retransmission queue length 0, number of retransmission 1
    First 0(0)/0(0) Next 0(0)/0(0)
    Last retransmission scan length is 1, maximum is 1
    Last retransmission scan time is 0 msec, maximum is 0 msec
    LS Ack list: NSR-sync pending 0, high water mark 0
    Adjacency SIDs:
        Label: 24000,    Dynamic, Unprotected
    Neighbor Interface ID: 5

 Neighbor 5.5.5.5, interface address 100.1.5.5
    In the area 0 via interface GigabitEthernet0/0/0/1 
    Neighbor priority is 1, State is FULL, 6 state changes
    DR is 100.1.5.5 BDR is 100.1.5.1
    Options is 0x52  
    LLS Options is 0x1 (LR)
    Dead timer due in 00:00:34
    Neighbor is up for 00:33:34
    Number of DBD retrans during last exchange 0
    Index 2/2, retransmission queue length 0, number of retransmission 0
    First 0(0)/0(0) Next 0(0)/0(0)
    Last retransmission scan length is 0, maximum is 0
    Last retransmission scan time is 0 msec, maximum is 0 msec
    LS Ack list: NSR-sync pending 0, high water mark 0
    Adjacency SIDs:
        Label: 24001,    Dynamic, Unprotected
    Neighbor Interface ID: 5


Total neighbor count: 2
```
Adjancacy SID, Unprotected ! 
```
RP/0/RP0/CPU0:xrd-1#show ospf neighbor detail 
Thu Oct 27 15:48:55.258 UTC

* Indicates MADJ interface
# Indicates Neighbor awaiting BFD session up
Neighbors for OSPF 1

 Neighbor 3.3.3.3, interface address 100.1.3.3
    In the area 0 via interface GigabitEthernet0/0/0/0 
    Neighbor priority is 1, State is FULL, 6 state changes
    DR is 100.1.3.3 BDR is 100.1.3.1
    Options is 0x52  
    LLS Options is 0x1 (LR)
    Dead timer due in 00:00:39
    Neighbor is up for 00:34:39
    Number of DBD retrans during last exchange 0
    Index 1/1, retransmission queue length 0, number of retransmission 1
    First 0(0)/0(0) Next 0(0)/0(0)
    Last retransmission scan length is 1, maximum is 1
    Last retransmission scan time is 0 msec, maximum is 0 msec
    LS Ack list: NSR-sync pending 0, high water mark 0
    Neighbor Interface ID: 5

 Neighbor 5.5.5.5, interface address 100.1.5.5
    In the area 0 via interface GigabitEthernet0/0/0/1 
    Neighbor priority is 1, State is FULL, 6 state changes
    DR is 100.1.5.5 BDR is 100.1.5.1
    Options is 0x52  
    LLS Options is 0x1 (LR)
    Dead timer due in 00:00:38
    Neighbor is up for 00:34:59
    Number of DBD retrans during last exchange 0
    Index 2/2, retransmission queue length 0, number of retransmission 0
    First 0(0)/0(0) Next 0(0)/0(0)
    Last retransmission scan length is 0, maximum is 0
    Last retransmission scan time is 0 msec, maximum is 0 msec
    LS Ack list: NSR-sync pending 0, high water mark 0
    Neighbor Interface ID: 5
```

sh ospf database opaque-area self-originate
```
RP/0/RP0/CPU0:xrd-1#traceroute 2.2.2.2                          

Thu Oct 27 15:56:07.009 UTC

Type escape sequence to abort.
Tracing the route to 2.2.2.2

 1  100.1.3.3 [MPLS: Label 16002 Exp 0] 2 msec  1 msec  1 msec 
 2  100.3.4.4 [MPLS: Label 16002 Exp 0] 1 msec  1 msec  1 msec 
 3  100.2.4.2 4 msec  *  2 msec 
```
```
traceroute mpls multipath ipv4 2.2.2.2/32
```

```
RP/0/RP0/CPU0:xrd-1#sh route 2.2.2.2 
Fri Oct 28 08:52:16.431 UTC

Routing entry for 2.2.2.2/32
  Known via "ospf 1", distance 110, metric 4, labeled SR, type intra area
  Installed Oct 28 08:49:49.745 for 00:02:26
  Routing Descriptor Blocks
    100.1.3.3, from 2.2.2.2, via GigabitEthernet0/0/0/0, Protected, ECMP-Backup (Local-LFA)
      Route metric is 4
    100.1.5.5, from 2.2.2.2, via GigabitEthernet0/0/0/1, Protected, ECMP-Backup (Local-LFA)
      Route metric is 4
  No advertising protos. 
```


```
RP/0/RP0/CPU0:xrd-1#traceroute sr-mpls multipath 2.2.2.2/32 ver
Fri Oct 28 08:41:42.083 UTC

Starting LSP Path Discovery for 2.2.2.2/32

Codes: '!' - success, 'Q' - request not sent, '.' - timeout,
  'L' - labeled output interface, 'B' - unlabeled output interface, 
  'D' - DS Map mismatch, 'F' - no FEC mapping, 'f' - FEC mismatch,
  'M' - malformed request, 'm' - unsupported tlvs, 'N' - no rx label, 
  'P' - no rx intf label prot, 'p' - premature termination of LSP, 
  'R' - transit router, 'I' - unknown upstream index,
  'X' - unknown return code, 'x' - return code 0

Type escape sequence to abort.

LL!
Path 0 found, 
 output interface GigabitEthernet0/0/0/0 nexthop 100.1.3.3
 source 100.1.3.1 destination 127.0.0.0
  0 100.1.3.1 100.1.3.3 MRU 1500 [Labels: 16002 Exp: 0] multipaths 0
L 1 100.1.3.3 100.3.4.4 MRU 1500 [Labels: 16002 Exp: 0] ret code 8 multipaths 1
L 2 100.3.4.4 100.2.4.2 MRU 1500 [Labels: implicit-null Exp: 0] ret code 8 multipaths 1
! 3 100.2.4.2, ret code 3 multipaths 0
LL!
Path 1 found, 
 output interface GigabitEthernet0/0/0/1 nexthop 100.1.5.5
 source 100.1.5.1 destination 127.0.0.0
  0 100.1.5.1 100.1.5.5 MRU 1500 [Labels: 16002 Exp: 0] multipaths 0
L 1 100.1.5.5 100.5.6.6 MRU 1500 [Labels: 16002 Exp: 0] ret code 8 multipaths 1
L 2 100.5.6.6 100.2.6.2 MRU 1500 [Labels: implicit-null Exp: 0] ret code 8 multipaths 1
! 3 100.2.6.2, ret code 3 multipaths 0

Paths (found/broken/unexplored) (2/0/0)
 Echo Request (sent/fail) (6/0)
 Echo Reply (received/timeout) (6/0)
 Total Time Elapsed 16 ms
```


---

# Configurations Annexes

## SR-MPLS Configurations

```bash
configure terminal
router ospf 1
 segment-routing mpls
 area 0
  segment-routing mpls
  interface Loopback0 passive
  interface Loopback0 prefix-sid absolute 16003
commit
```

```bash
configure terminal
router ospf 1
 segment-routing mpls
 area 0
  segment-routing mpls
  interface Loopback0 passive
  interface Loopback0 prefix-sid absolute 16004
commit
```

```bash
configure terminal
router ospf 1
 segment-routing mpls
 area 0
  segment-routing mpls
  interface Loopback0 passive
  interface Loopback0 prefix-sid absolute 16005
commit
```

```bash
configure terminal
router ospf 1
 segment-routing mpls
 area 0
  segment-routing mpls
  interface Loopback0 passive
  interface Loopback0 prefix-sid absolute 16006
commit
```